using SimpleBankingSystem;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text;


namespace SimpleBankingSystem
{
    static class UI
    {
        private static string Centered(string s, int width)
        {
            if (s.Length >= width) return s.Substring(0, width);
            int leftPadding = (width - s.Length) / 2;
            return new string(' ', leftPadding) + s + new string(' ', width - s.Length - leftPadding);
        }

        public static string PromptMenu(string title, string[] options, string parentTitle = (""))
        {
            Console.Clear();


            if (!string.IsNullOrEmpty(parentTitle))
            {
                Console.ForegroundColor = ConsoleColor.Cyan;
                Console.WriteLine($"╔{new string('═', 42)}╗");
                Console.WriteLine($"║ {Centered(parentTitle, 40)} ║");
                Console.WriteLine($"╚{new string('═', 42)}╝");
                Console.ResetColor();
            }

            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.WriteLine($"╔{new string('═', 42)}╗");
            Console.WriteLine($"║ {Centered(title, 40)} ║");
            Console.WriteLine($"╚{new string('═', 42)}╝");
            Console.ResetColor();


            Console.WriteLine();
            foreach (var opt in options)
            {

                int bracketEnd = opt.IndexOf(']');
                if (bracketEnd > -1)
                {
                    Console.ForegroundColor = ConsoleColor.Yellow;
                    Console.Write((" ") + opt.Substring(0, bracketEnd + 1));
                    Console.ResetColor();
                    Console.WriteLine(opt.Substring(bracketEnd + 1));
                }
                else
                {
                    Console.WriteLine($" {opt}");
                }
            }

            Console.WriteLine(new string('-', 44));
            Console.Write((" Enter Choice > "));
            return Console.ReadLine() ?? ("");
        }

        public static void Title(string title)
        {

            Console.Clear();
            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.WriteLine($"╔{new string('═', 42)}╗");
            Console.WriteLine($"║ {Centered(title, 40)} ║");
            Console.WriteLine($"╚{new string('═', 42)}╝");
            Console.ResetColor();
            Console.WriteLine();

        }

        public static string Input(string label)
        {

            Console.Write($" {label.PadRight(20)}: ");
            return Console.ReadLine() ?? ("");

        }

        public static void PrintSuccess(string msg)
        {
            Console.WriteLine();
            Console.ForegroundColor = ConsoleColor.Green;
            Console.WriteLine($" ✔ {msg}");
            Console.ResetColor();
            Console.WriteLine((" Press any key to continue..."));
            Console.ReadKey();
        }

        public static void PrintError(string msg)
        {
            Console.WriteLine();
            Console.ForegroundColor = ConsoleColor.Red;
            Console.WriteLine($" ✖ {msg}");
            Console.ResetColor();
            Console.ReadKey();
        }
    }



    class Person
    {
        public string FullName
        {
            get;
            set;
        } = ("");
        public string Address
        {
            get;
            set;
        } = ("");
        public string ContactNo
        {
            get;
            set;
        } = ("");
    }

    class UserAccount : Person
    {
        public string Username
        {
            get;
            set;
        } = ("");
        public string Password
        {
            get;
            set;
        } = ("");
    }

    abstract class Account : Person
    {
        public int AccountID
        {
            get;
            set;
        }
        public string OwnerUsername
        {
            get;
            set;
        } = ("");

        public double Balance
        {
            get;
            set;
        }
        public string AccountType
        {
            get;
            set;

        } = ("Account");

        public virtual void Deposit(double amount)
        {
            if (amount <= 0) throw new ArgumentException(("Amount must be positive."));
            Balance += amount;
        }

        public virtual void Withdraw(double amount)
        {
            if (amount <= 0) throw new ArgumentException(("Amount must be positive."));
            if (amount > Balance) throw new InvalidOperationException(("Insufficient funds."));
            Balance -= amount;
        }

        public virtual string ToCsv()
        {
            return string.Join((","), new[]
            {
                AccountType, AccountID.ToString(), Safe(OwnerUsername), Safe(FullName),
                Safe(Address), Safe(ContactNo), Balance.ToString(CultureInfo.InvariantCulture), ("0")
            });
        }

        public static string Safe(string s) => (s ?? ("")).Replace(",", " ");
    }

    class SavingsAccount : Account
    {
        public double InterestRate
        {
            get;
            set;
        } = (0.0);

        public SavingsAccount()
        {
            AccountType = ("Savings");
        }
        public override string ToCsv()
        {
            return string.Join((","), new[]
            {
                AccountType, AccountID.ToString(), Safe(OwnerUsername), Safe(FullName),
                Safe(Address), Safe(ContactNo), Balance.ToString(CultureInfo.InvariantCulture),
                InterestRate.ToString(CultureInfo.InvariantCulture)
            });
        }
    }

    class CheckingAccount : Account
    {
        public CheckingAccount()
        {
            AccountType = ("Checking");
        }
    }
    class ATMAccount : Account
    {
        public ATMAccount()
        {
            AccountType = ("ATM");
        }
    }
    class DebitAccount : Account
    {
        public DebitAccount()
        {
            AccountType = ("Debit");
        }
    }

    class TimeDepositAccount : Account
    {
        public int TermMonths
        {
            get;
            set;

        } = (0);
        public TimeDepositAccount()
        {
            AccountType = ("Time Deposit");
        }
        public override string ToCsv()
        {
            return string.Join((","), new[]
            {
                AccountType, AccountID.ToString(), Safe(OwnerUsername), Safe(FullName),
                Safe(Address), Safe(ContactNo), Balance.ToString(CultureInfo.InvariantCulture),
                TermMonths.ToString()
            });
        }
    }

    class ForeignAccount : Account
    {
        public string Currency
        {
            get;
            set;
        } = ("USD");

        public ForeignAccount()
        {
            AccountType = ("Foreign");
        }
        public override string ToCsv()
        {
            return string.Join(",", new[]
            {
                AccountType, AccountID.ToString(), Safe(OwnerUsername), Safe(FullName),
                Safe(Address), Safe(ContactNo), Balance.ToString(CultureInfo.InvariantCulture), Currency
            });
        }
    }


    interface IFileHandler
    {
        void SaveAll();
        void LoadAll();
    }


    class BankManager : IFileHandler
    {
        private readonly string accountsPath = ("accounts.csv");
        private readonly string usersPath = ("users.csv");

        public List<Account>
            Accounts
        {
            get;
            private set;

        } = new List<Account>();

        public List<UserAccount>
            Users
        {
            get;
            private set;
        } = new List<UserAccount>();

        private readonly string employeeUsername = ("admin");
        private readonly string employeePassword = ("admin123");

        public BankManager()
        {
            LoadAll();

        }

        private int NextAccountId() => Accounts.Count == 0 ? 1001 : Accounts.Max(a => a.AccountID) + 1;


        public bool RegisterUser()
        {
            UI.Title("REGISTER NEW USER");
            string username = UI.Input("Choose Username");

            if (string.IsNullOrEmpty(username))
            {
                UI.PrintError("Username empty.");

                return false;

            }

            if (Users.Any(u => u.Username.Equals(username, StringComparison.OrdinalIgnoreCase)))
            {
                UI.PrintError("Username taken.");

                return false;
            }

            string name = UI.Input("Full Name");
            string addr = UI.Input("Address");
            string contact = UI.Input("Contact No");

            Console.Write($" {"Password".PadRight(20)}: ");
            string pwd = Program.ReadPassword();

            Users.Add(new UserAccount { Username = username, Password = pwd, FullName = name, Address = addr, ContactNo = contact });
            SaveUsersToFile();
            UI.PrintSuccess("Registration Successful!");
            return true;
        }

        public UserAccount? LoginUser()
        {
            UI.Title("USER LOGIN");
            string u = UI.Input("Username");
            Console.Write($" {("Password").PadRight(20)}: ");
            string p = Program.ReadPassword();

            var user = Users.FirstOrDefault(x => x.Username.Equals(u, StringComparison.OrdinalIgnoreCase) && x.Password == p);

            if (user == null)
            {
                UI.PrintError("Invalid credentials.");
                return null;
            }
            return user;
        }

        public bool LoginEmployee()
        {
            UI.Title("EMPLOYEE LOGIN");
            string u = UI.Input("Admin Username");
            Console.Write($" {"Password".PadRight(20)}: ");
            string p = Program.ReadPassword();

            if (u == employeeUsername && p == employeePassword) return true;
            UI.PrintError("Invalid admin credentials.");
            return false;
        }


        public void CreateAccountForOwner(string? ownerUsername = null)
        {
            UI.Title("CREATE NEW ACCOUNT");
            Console.WriteLine(" Select Account Type:");
            string[] types = { ("[1] Savings"), ("[2] Checking"), ("[3] ATM"), ("[4] Debit"), ("[5] Time Deposit"), ("[6] Foreign") };
            foreach (var t in types) Console.WriteLine(("  ") + t);
            Console.WriteLine(new string('-', 30));

            string choice = UI.Input(("Selection"));

            Account acc;

            switch (choice)
            {

                case ("1"):
                    acc = new SavingsAccount();
                    break;
                case ("2"):
                    acc = new CheckingAccount();
                    break;
                case ("3"):
                    acc = new ATMAccount();
                    break;
                case ("4"):
                    acc = new DebitAccount();
                    break;
                case ("5"):
                    acc = new TimeDepositAccount();
                    break;
                case ("6"):
                    acc = new ForeignAccount();
                    break;
                default:
                    UI.PrintError(("Invalid Selection."));

                    return;
            }

            acc.AccountID = NextAccountId();

            if (string.IsNullOrEmpty(ownerUsername))
            {
                ownerUsername = UI.Input(("Enter Username"));
            }
            var owner = Users.FirstOrDefault(u => u.Username.Equals(ownerUsername, StringComparison.OrdinalIgnoreCase));
            if (owner == null)
            {
                UI.PrintError(("User not found."));

                return;
            }

            acc.OwnerUsername = owner.Username;
            acc.FullName = owner.FullName;
            acc.Address = owner.Address;
            acc.ContactNo = owner.ContactNo;

            Console.WriteLine(("\n --- DETAILS ---"));

            string balStr = UI.Input(("Initial Deposit"));
            if (!double.TryParse(balStr, NumberStyles.Float, CultureInfo.InvariantCulture, out var bal)) bal = 0;
            acc.Balance = bal;

            if (acc is SavingsAccount s)
            {
                string rStr = UI.Input("Interest Rate (%)");
                if (double.TryParse(rStr, out var r)) s.InterestRate = r;
            }
            else if (acc is TimeDepositAccount t)
            {
                string mStr = UI.Input("Term (Months)");
                if (int.TryParse(mStr, out var m)) t.TermMonths = m;
            }
            else if (acc is ForeignAccount f)
            {
                f.Currency = UI.Input("Currency").ToUpper();
            }

            Accounts.Add(acc);
            SaveAccountsToFile();
            UI.PrintSuccess($"Account Created! ID: {acc.AccountID}");
        }



        private string GetCurrencySymbol(Account acc)
        {
            if (acc is ForeignAccount foreignAcc)
            {
                return foreignAcc.Currency.ToUpper() switch
                {
                    ("USD") => ("$"),
                    ("EUR") => ("€"),
                    ("JPY") => ("¥"),
                    _ => foreignAcc.Currency + (" ")
                };
            }
            return ("₱"); 
        }


        public void DepositAny()
        {
            UI.Title("DEPOSIT FUNDS");
            if (!int.TryParse(UI.Input("Account ID"), out var id))
            {
                UI.PrintError("Invalid ID.");
                return;
            }

            var acc = Accounts.FirstOrDefault(a => a.AccountID == id);
            if (acc == null)
            {
                UI.PrintError("Account not found.");
                return;
            }


            string symbol = GetCurrencySymbol(acc);

            Console.WriteLine($"\n   Owner             : {acc.FullName}");
            Console.WriteLine($"   Current Balance   : {symbol}{acc.Balance:N2}\n"); 
            if (!double.TryParse(UI.Input("Amount to Deposit"), NumberStyles.Float, CultureInfo.InvariantCulture, out var amt))
            {
                UI.PrintError("Invalid Amount.");
                return;
            }

            try
            {

                double oldBalance = acc.Balance; 
                acc.Deposit(amt);
                SaveAccountsToFile();


                Console.WriteLine("\n--- TRANSACTION SUMMARY ---");
                Console.WriteLine($" {"Previous Balance".PadRight(20)}: {symbol}{oldBalance:N2}"); 
                Console.WriteLine($" {"Amount Deposited".PadRight(20)}: {symbol}{amt:N2}"); 

                UI.PrintSuccess($"Transaction Successful! New Balance: {symbol}{acc.Balance:N2}");
            }

            catch (Exception ex)
            {

                UI.PrintError(ex.Message);

            }
        }

        public void WithdrawAny()
        {
            UI.Title("WITHDRAW FUNDS");
            if (!int.TryParse(UI.Input("Account ID"), out var id))
            {
                UI.PrintError("Invalid ID.");
                return;
            }

            var acc = Accounts.FirstOrDefault(a => a.AccountID == id);
            if (acc == null)
            {
                UI.PrintError("Account not found.");
                return;
            }

            string symbol = GetCurrencySymbol(acc); 

            Console.WriteLine($"\n   Owner             : {acc.FullName}");
            Console.WriteLine($"   Current Balance   : {symbol}{acc.Balance:N2}\n");
            if (!double.TryParse(UI.Input("Amount to Withdraw"), NumberStyles.Float, CultureInfo.InvariantCulture, out var amt))
            {
                UI.PrintError("Invalid Amount.");
                return;
            }

            try
            {
                double oldBalance = acc.Balance;
                acc.Withdraw(amt);
                SaveAccountsToFile();

                
                Console.WriteLine("\n--- TRANSACTION SUMMARY ---");
                Console.WriteLine($" {"Previous Balance".PadRight(20)}: {symbol}{oldBalance:N2}"); 
                Console.WriteLine($" {"Amount Withdrawn".PadRight(20)}: {symbol}{amt:N2}"); 

                UI.PrintSuccess($"Transaction Successful! New Balance: {symbol}{acc.Balance:N2}"); 
            }

            catch (Exception ex)
            {

                UI.PrintError(ex.Message);

            }
        }

        public void DeleteAccount()
        {
            UI.Title("DELETE ACCOUNT");
            if (!int.TryParse(UI.Input("Account ID"), out var id))
            {

                UI.PrintError("Invalid ID.");
                return;

            }

            var acc = Accounts.FirstOrDefault(a => a.AccountID == id);
            if (acc != null)
            {

                Accounts.Remove(acc);
                SaveAccountsToFile();
                UI.PrintSuccess("Deleted.");

            }

            else UI.PrintError("Not found.");

        }


        public void DepositToMyAccount(UserAccount user)
        {
            UI.Title("MY DEPOSIT");
            if (!int.TryParse(UI.Input("Your Account ID"), out var id))
            {

                UI.PrintError("Invalid ID.");
                return;

            }

            var acc = Accounts.FirstOrDefault(a => a.AccountID == id && a.OwnerUsername.Equals(user.Username, StringComparison.OrdinalIgnoreCase));
            if (acc == null) 
            { 
                UI.PrintError("Account not found/owned by you.");
                
                return; 

            }


            string symbol = GetCurrencySymbol(acc);

            Console.WriteLine($"\n   Current Balance   : {symbol}{acc.Balance:N2}\n");
            if (!double.TryParse(UI.Input("Amount"), out var amt))
            {

                UI.PrintError("Invalid Amount.");
                return;

            }

            try
            {
                double oldBalance = acc.Balance;
                acc.Deposit(amt);
                SaveAccountsToFile();

               
                Console.WriteLine("\n--- TRANSACTION SUMMARY ---");
                Console.WriteLine($" {"Previous Balance".PadRight(20)}: {symbol}{oldBalance:N2}"); 
                Console.WriteLine($" {"Amount Deposited".PadRight(20)}: {symbol}{amt:N2}");

                UI.PrintSuccess($"Transaction Successful! New Balance: {symbol}{acc.Balance:N2}"); 
            }

            catch (Exception ex)
            {

                UI.PrintError(ex.Message);

            }
        }

        public void WithdrawFromMyAccount(UserAccount user)
        {
            UI.Title("MY WITHDRAWAL");
            if (!int.TryParse(UI.Input("Your Account ID"), out var id))
            {
                UI.PrintError("Invalid ID.");
                return;
            }

            var acc = Accounts.FirstOrDefault(a => a.AccountID == id && a.OwnerUsername.Equals(user.Username, StringComparison.OrdinalIgnoreCase));
            if (acc == null)
            {
                UI.PrintError("Account not found/owned by you.");
                return;
            }

            string symbol = GetCurrencySymbol(acc);

            Console.WriteLine($"\n   Current Balance   : {symbol}{acc.Balance:N2}\n");
            if (!double.TryParse(UI.Input("Amount"), out var amt))
            {
                UI.PrintError("Invalid Amount.");
                return;
            }

            try
            {
                double oldBalance = acc.Balance;
                acc.Withdraw(amt);
                SaveAccountsToFile();

                
                Console.WriteLine("\n--- TRANSACTION SUMMARY ---");
                Console.WriteLine($" {"Previous Balance".PadRight(20)}: {symbol}{oldBalance:N2}");
                Console.WriteLine($" {"Amount Withdrawn".PadRight(20)}: {symbol}{amt:N2}");

                UI.PrintSuccess($"Transaction Successful! New Balance: {symbol}{acc.Balance:N2}");
            }
            catch (Exception ex)
            {

                UI.PrintError(ex.Message);

            }
        }

        
        public void ViewAllAccounts()
        {
            UI.Title("ALL ACCOUNTS DATABASE");
            RenderAccountTable(Accounts);
            Console.ReadKey();
        }

        public void ViewMyAccounts(UserAccount user)
        {
            UI.Title($"ACCOUNTS FOR {user.FullName.ToUpper()}");
            var my = Accounts.Where(a => a.OwnerUsername.Equals(user.Username, StringComparison.OrdinalIgnoreCase)).ToList();
            RenderAccountTable(my);
        }

        public void SearchAccount()
        {
            UI.Title("SEARCH ACCOUNT");

            if (!int.TryParse(UI.Input("Enter ID"), out var id))
            {

                UI.PrintError("Invalid ID.");
                return;

            }

            var acc = Accounts.FirstOrDefault(a => a.AccountID == id);

            if (acc == null)
            {

                UI.PrintError("Not found.");
                return;

            }

            RenderAccountTable(new List<Account> { acc });

            Console.ReadKey();
        }

        private void RenderAccountTable(List<Account> list)
        {
            if (!list.Any())
            {
                Console.WriteLine("\n   No accounts found.");
                return;
            }

            const int idW = 10, typeW = 14, ownerW = 18, balW = 16;

            Console.WriteLine();
            Console.WriteLine($"╔{new string('═', idW)}╦{new string('═', typeW)}╦{new string('═', ownerW)}╦{new string('═', balW)}╗");

            Console.Write("║");
            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.Write($" {"ID".PadRight(idW - 1)}");
            Console.ResetColor();
            Console.Write("║");
            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.Write($" {"Type".PadRight(typeW - 1)}");
            Console.ResetColor();
            Console.Write("║");
            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.Write($" {"Owner".PadRight(ownerW - 1)}");
            Console.ResetColor();
            Console.Write("║");
            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.Write($" {"Balance".PadLeft(balW - 1)}");
            Console.ResetColor();
            Console.WriteLine("║");

            Console.WriteLine($"╠{new string('═', idW)}╬{new string('═', typeW)}╬{new string('═', ownerW)}╬{new string('═', balW)}╣");

            foreach (var a in list)
            {
                string symbol = GetCurrencySymbol(a);

                Console.Write($"║ {a.AccountID.ToString().PadRight(idW - 1)}");
                Console.Write($"║ {a.AccountType.PadRight(typeW - 1)}");

                string owner = string.IsNullOrEmpty(a.OwnerUsername) ? a.FullName : a.OwnerUsername;
                if (owner.Length > ownerW - 2) owner = owner.Substring(0, ownerW - 5) + "...";
                Console.Write($"║ {owner.PadRight(ownerW - 1)}");

                Console.Write("║ ");
                Console.ForegroundColor = ConsoleColor.Green;

                string balanceStr = $"{symbol}{a.Balance.ToString("N2")}";
                Console.Write($"{balanceStr.PadLeft(balW - 1)}");
                Console.ResetColor();
                Console.WriteLine(("║"));
            }
            Console.WriteLine($"╚{new string('═', idW)}╩{new string('═', typeW)}╩{new string('═', ownerW)}╩{new string('═', balW)}╝");
        }




        public void SaveAll()
        {
            SaveAccountsToFile();
            SaveUsersToFile();
        }
        public void LoadAll()
        {
            LoadUsersFromFile();
            LoadAccountsFromFile();
        }

        private void SaveUsersToFile()
        {
            var lines = Users.Select(u => string.Join((","), u.Username,
                Account.Safe(u.Password),
                Account.Safe(u.FullName),
                Account.Safe(u.Address),
                Account.Safe(u.ContactNo)));

            File.WriteAllLines(usersPath, lines);
        }
        private void LoadUsersFromFile()
        {
            Users.Clear();
            if (!File.Exists(usersPath))
                return;
            foreach (var line in File.ReadAllLines(usersPath))
            {
                var p = line.Split(',');
                if (p.Length < 5)
                    continue;
                Users.Add(new UserAccount 
                { 
                    Username = p[0], 
                    Password = p[1], 
                    FullName = p[2], 
                    Address = p[3], 
                    ContactNo = p[4] 
                });
            }
        }
        private void SaveAccountsToFile() => File.WriteAllLines(accountsPath, Accounts.Select(a => a.ToCsv()));
        private void LoadAccountsFromFile()
        {
            Accounts.Clear();
            if (!File.Exists(accountsPath))
                return;
            foreach (var line in File.ReadAllLines(accountsPath))
            {
                var cols = line.Split(',');
                if (cols.Length < 7)
                    continue;
                if (!int.TryParse(cols[1], out int id))
                    continue;
                if (!double.TryParse(cols[6], NumberStyles.Float, CultureInfo.InvariantCulture, out double bal))
                    bal = 0;
                string extra = cols.Length > 7 ? cols[7] : ("");

                Account acc = cols[0]
                    switch
                {
                    ("Savings") => new SavingsAccount
                    { InterestRate = double.TryParse(extra, out double r) ? r : 0 },
                    ("Checking") => new CheckingAccount(),
                    ("ATM") => new ATMAccount(),
                    ("Debit") => new DebitAccount(),
                    ("Time Deposit") => new TimeDepositAccount
                    { TermMonths = int.TryParse(extra, out int m) ? m : 0 },
                    ("Foreign") => new ForeignAccount
                    { Currency = extra },
                    _ => new CheckingAccount()
                };
                acc.AccountID = id;
                acc.OwnerUsername = cols[2];
                acc.FullName = cols[3];
                acc.Address = cols[4];
                acc.ContactNo = cols[5];
                acc.Balance = bal;

                Accounts.Add(acc);
            }
        }
    }


    class Program
    {
        static void Main()
        {

            Console.OutputEncoding = Encoding.UTF8;
            Console.Title = ("Simple Banking System");

            var manager = new BankManager();
            bool running = true;

            while (running)
            {

                string choice = UI.PromptMenu(
                    ("MAIN SYSTEM"),
                    new[]
                    {
                        ("[1] Login as Bank Employee"),
                        ("[2] Login as Account Holder"),
                        ("[3] Register New User"),
                        ("[4] Exit System")
                    },
                    ("SIMPLE BANKING SYSTEM")
                );

                switch (choice)
                {
                    case ("1"):
                        if (manager.LoginEmployee()) EmployeeActionLoop(manager);
                        break;
                    case ("2"):
                        var user = manager.LoginUser();
                        if (user != null) CustomerActionLoop(manager, user);
                        break;
                    case ("3"):
                        manager.RegisterUser();
                        break;
                    case ("4"):
                        manager.SaveAll();
                        UI.PrintSuccess("System Saved. Shutting down...");
                        running = false;
                        break;
                    default:
                        UI.PrintError("Invalid selection. Try again.");
                        break;
                }
            }
        }

        static void EmployeeActionLoop(BankManager mgr)
        {
            while (true)
            {
                string choice = UI.PromptMenu(("EMPLOYEE DASHBOARD"), new[]
                {
                    ("[1] Create New Account"),
                    ("[2] View All Accounts"),
                    ("[3] Search Account by ID"),
                    ("[4] Deposit Funds (Any)"),
                    ("[5] Withdraw Funds (Any)"),
                    ("[6] Delete Account"),
                    ("[7] Logout")
                });

                switch (choice)
                {
                    case ("1"):
                        mgr.CreateAccountForOwner();
                        break;
                    case ("2"):
                        mgr.ViewAllAccounts();
                        break;
                    case ("3"):
                        mgr.SearchAccount();
                        break;
                    case ("4"):
                        mgr.DepositAny();
                        break;
                    case ("5"):
                        mgr.WithdrawAny();
                        break;
                    case ("6"):
                        mgr.DeleteAccount();
                        break;
                    case ("7"):
                        return;

                    default:
                        UI.PrintError("Invalid command.");
                        break;
                }
            }
        }

        static void CustomerActionLoop(BankManager mgr, UserAccount user)
        {
            while (true)
            {
                string choice = UI.PromptMenu($"WELCOME, {user.FullName.ToUpper()}", new[]
                {
                    ("[1] View My Accounts"),
                    ("[2] Deposit Funds"),
                    ("[3] Withdraw Funds"),
                    ("[4] Open New Account"),
                    ("[5] Logout")
                });

                switch (choice)
                {
                    case ("1"):
                        mgr.ViewMyAccounts(user);
                        Console.WriteLine(("\n Press any key to return..."));
                        Console.ReadKey();
                        break;
                    case ("2"):
                        mgr.DepositToMyAccount(user);
                        break;
                    case ("3"):
                        mgr.WithdrawFromMyAccount(user);
                        break;
                    case ("4"):
                        mgr.CreateAccountForOwner(user.Username);
                        break;
                    case ("5"): return;
                    default:
                        UI.PrintError("Invalid command.");
                        break;
                }
            }
        }

        public static string ReadPassword()
        {
            string password = ("");
            ConsoleKeyInfo key;
            do
            {
                key = Console.ReadKey(true);
                if (key.Key != ConsoleKey.Enter && key.Key != ConsoleKey.Backspace)
                {
                    password += key.KeyChar;
                    Console.Write(("*"));
                }
                else if (key.Key == ConsoleKey.Backspace && password.Length > 0)
                {
                    password = password[..^1];
                    Console.Write(("\b \b"));
                }
            } while (key.Key != ConsoleKey.Enter);
            Console.WriteLine();
            return password;
        }
    }
}